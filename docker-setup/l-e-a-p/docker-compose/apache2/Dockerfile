# 1. Select base image (Debian Version)
FROM ubuntu/apache2:latest
WORKDIR /etc/apache2/

# 2. Install nano to CRUD the necessary configs
RUN apt-get update && apt-get install -y nano openssl curl && rm -rf /var/lib/apt/lists/*

# 3. Replace the default apache2 default config with pre-conf custom L-E-A-P settings
# temporary = https://github.com/setiyadi-ben/Linux-Engineer-Applied-Practice/blob/main/Java-Webapps-Simulation/terminal-commands.md#06
RUN a2dissite 000-default.conf default-ssl.conf
COPY 000-default.conf /etc/apache2/sites-available/website_ssl.conf
RUN a2enmod headers ssl proxy proxy_http rewrite && \
    a2ensite website_ssl.conf

# 4. Replace the main apache html files with l-e-a-p progress homepage
COPY ./web_files /var/www/html

# 4. Import, change ownership and run autogenerated unsecure HTTPS SSL certificate
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
CMD ["apache2ctl", "-D", "FOREGROUND"]