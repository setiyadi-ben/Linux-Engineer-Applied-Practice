# 1. Select base image
FROM ubuntu/apache2:latest

# 2. Home directory, in order to place the files into
WORKDIR /etc/apache2/

# 3. Install nano to CRUD the necessary configs
RUN apt-get update && apt-get install -y nano
# 4. Install openssl to perform free unsecure HTTPS SSL certificate
RUN apt-get update && apt-get install -y openssl

# 5. Replace the default apache2 default config with pre-conf custom L-E-A-P settings
# temporary = https://github.com/setiyadi-ben/Linux-Engineer-Applied-Practice/blob/main/Java-Webapps-Simulation/terminal-commands.md#06
COPY 000-default.conf /etc/apache2/sites-available/

# 6. Enable the pre-conf custom L-E-A-P settings
RUN a2enmod ssl proxy proxy_http rewrite && \
a2ensite 000-default.conf

# 7. Import, change ownership and run autogenerated unsecure HTTPS SSL certificate
COPY https-entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
CMD ["apache2ctl", "-D", "FOREGROUND"]

# 8. Saving the generated free unsecure HTTPS SSL certificate into docker volume
VOLUME ["/etc/ssl/certs", "/etc/ssl/private"]

# 9. Notify the admin that apache2 running in https mode on port 443
EXPOSE 443